function show_results(){for(var t=[],e="",n=0;n<test_results.length;n++){var r=test_results[n];r.result?e+=".":(e+="F",t.push(r.message))}console.log(e),console.log("Tests completed. Passed: "+(test_results.length-t.length)+", Failed: "+t.length);for(var n=0;n<t.length;n++){var i=t[n];throw new Error(i)}}"bind"in Function.prototype||(Function.prototype.bind=function(t){var e=this;if(arguments.length<=1)return function(){return e.apply(t,arguments)};var n=Array.prototype.slice.call(arguments,1);return function(){return e.apply(t,0===arguments.length?n:n.concat(Array.prototype.slice.call(arguments)))}}),"trim"in String.prototype||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}),"indexOf"in Array.prototype||(Array.prototype.indexOf=function(t,e){void 0===e&&(e=0),0>e&&(e+=this.length),0>e&&(e=0);for(var n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1}),"lastIndexOf"in Array.prototype||(Array.prototype.lastIndexOf=function(t,e){for(void 0===e&&(e=this.length-1),0>e&&(e+=this.length),e>this.length-1&&(e=this.length-1),e++;e-->0;)if(e in this&&this[e]===t)return e;return-1}),"forEach"in Array.prototype||(Array.prototype.forEach=function(t,e){for(var n=0,r=this.length;r>n;n++)n in this&&t.call(e,this[n],n,this)}),"map"in Array.prototype||(Array.prototype.map=function(t,e){for(var n=new Array(this.length),r=0,i=this.length;i>r;r++)r in this&&(n[r]=t.call(e,this[r],r,this));return n}),"filter"in Array.prototype||(Array.prototype.filter=function(t,e){for(var n,r=[],i=0,o=this.length;o>i;i++)i in this&&t.call(e,n=this[i],i,this)&&r.push(n);return r}),"every"in Array.prototype||(Array.prototype.every=function(t,e){for(var n=0,r=this.length;r>n;n++)if(n in this&&!t.call(e,this[n],n,this))return!1;return!0}),"some"in Array.prototype||(Array.prototype.some=function(t,e){for(var n=0,r=this.length;r>n;n++)if(n in this&&t.call(e,this[n],n,this))return!0;return!1});var JSON;JSON||(JSON={}),function(){"use strict";function f(t){return 10>t?"0"+t:t}function quote(t){return escapable.lastIndex=0,escapable.test(t)?'"'+t.replace(escapable,function(t){var e=meta[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'}function str(t,e){var n,r,i,o,s,a=gap,u=e[t];switch(u&&"object"==typeof u&&"function"==typeof u.toJSON&&(u=u.toJSON(t)),"function"==typeof rep&&(u=rep.call(e,t,u)),typeof u){case"string":return quote(u);case"number":return isFinite(u)?String(u):"null";case"boolean":case"null":return String(u);case"object":if(!u)return"null";if(gap+=indent,s=[],"[object Array]"===Object.prototype.toString.apply(u)){for(o=u.length,n=0;o>n;n+=1)s[n]=str(n,u)||"null";return i=0===s.length?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+a+"]":"["+s.join(",")+"]",gap=a,i}if(rep&&"object"==typeof rep)for(o=rep.length,n=0;o>n;n+=1)"string"==typeof rep[n]&&(r=rep[n],i=str(r,u),i&&s.push(quote(r)+(gap?": ":":")+i));else for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(i=str(r,u),i&&s.push(quote(r)+(gap?": ":":")+i));return i=0===s.length?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+a+"}":"{"+s.join(",")+"}",gap=a,i}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(t,e,n){var r;if(gap="",indent="","number"==typeof n)for(r=0;n>r;r+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=e,e&&"function"!=typeof e&&("object"!=typeof e||"number"!=typeof e.length))throw new Error("JSON.stringify");return str("",{"":t})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(t,e){var n,r,i=t[e];if(i&&"object"==typeof i)for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(r=walk(i,n),void 0!==r?i[n]=r:delete i[n]);return reviver.call(t,e,i)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),function(){var t,e=[].slice;t="undefined"!=typeof exports&&null!==exports?exports:this,t.Fishpond=function(){function t(e,n){var r;this.api_key=e,this.options=null!=n?n:{},this.created_at=new Date,this._ready=!1,this.log("Creating fishpond instance"),this.connection=new t.prototype.Connection(this),r=this,this.loading(function(t){return r.log("Loading "+100*t+"%")}),this.ready(function(t){return r.log("Ready to query '"+t+"'")}),this.error(function(t){return r.log("Error"),r.log(t)}),this.resultsUpdated(function(t){return r.log("Results updated"),r.raw_log(t)})}return t.prototype.init=function(e){var n;return this.pond_id=e,n=this,this.log("Init with pond "+this.pond_id),n.trigger("loading",0),this.connection.request(["ponds",this.pond_id],function(e){return n.pond=new t.prototype.Pond(n),n.pond.build(e),n.debug("Loaded pond '"+n.pond+"'"),n.pond.load_all_fish(function(){return n.trigger("loading",1),this._ready=!0,n.log("Ready"),n.trigger("ready",n.pond)})})},t.prototype.trigger=function(){var t,n;return n=arguments[0],t=2<=arguments.length?e.call(arguments,1):[],this.callbacks[n](t[0])},t.prototype.time_alive=function(){return parseInt((new Date-this.created_at)/1e3,10)},t.prototype.enable_event_tracking=function(t,e){var n,r,i,o;return this.event_tracking_enabled=!0,o=o||[],o.push(["_setAccount",t]),o.push(["_setDomainName",e]),o.push(["_setAllowLinker",!0]),o.push(["_trackPageview"]),n=document.createElement("script"),n.type="text/javascript",n.async=!0,i="http://www","https:"===document.location.protocol&&(i="https://ssl"),n.src=""+i+".google-analytics.com/ga.js",r=document.getElementsByTagName("script")[0],r.parentNode.insertBefore(n,r),this.log("Event tracking enabled with ID "+t+" on "+e)},t}()}.call(this),function(){Fishpond.prototype.log=function(t){return this.raw_log("[Fishpond] "+t)},Fishpond.prototype.debug=function(t){return this.options.debug===!0?this.log(t):void 0},Fishpond.prototype.raw_log=function(t){return this.options.quiet!==!0&&console&&console.log?console.log(t):void 0},Fishpond.prototype.arrays_equal=function(t,e){return t.length===e.length&&t.every(function(t){return-1!==e.indexOf(t)})},Fishpond.prototype.array_unique=function(t){var e,n,r,i,o,s;for(n={},e=i=0,o=t.length;o>=0?o>i:i>o;e=o>=0?++i:--i)n[t[e]]=t[e];s=[];for(e in n)r=n[e],s.push(r);return s}}.call(this),function(){Fishpond.prototype.Pond=function(){function t(t){this.fishpond=t}return t.prototype.build=function(t){var e,n,r,i,o,s,a,u,p;for(this.id=t.id,this.name=t.name,this.fish_count=t.fish_count,this.tags=t.tags,this.filters=t.filters,this.tag_ids={community:"community"},this.filter_ids={},this.fish=[],a=this.tags,r=0,o=a.length;o>r;r++)n=a[r],this.tag_ids[n.slug]=n.id;for(u=this.filters,p=[],i=0,s=u.length;s>i;i++)e=u[i],p.push(this.filter_ids[e.slug]=e.id);return p},t.prototype.toString=function(){return this.name},t.prototype.load_all_fish=function(t){return this.fishpond.debug("Loading "+this.fish_count+" fish"),this.load_fish(1,t)},t.prototype.find_fish=function(t){var e,n,r,i;for(i=this.fish,n=0,r=i.length;r>n;n++)if(e=i[n],e.id===t)return e;return void 0},t.prototype.default_query_tags=function(){var t,e,n,r,i;for(t={},i=this.tags,n=0,r=i.length;r>n;n++)e=i[n],t[e.id]=10;return t},t.prototype.slugged_tag_name=function(t){var e,n,r,i;for(i=this.tags,n=0,r=i.length;r>n;n++)if(e=i[n],e.id===t)return e.slug},t.prototype.humanized_tag_name=function(t){var e,n,r,i;for(i=this.tags,n=0,r=i.length;r>n;n++)if(e=i[n],e.id===t)return e.name},t.prototype.default_query_filters=function(){var t,e,n,r,i;for(t={},i=this.filters,n=0,r=i.length;r>n;n++)e=i[n],t[e.id]=!1;return t},t.prototype.slugged_filter_name=function(t){var e,n,r,i;for(i=this.filters,n=0,r=i.length;r>n;n++)if(e=i[n],e.id===t)return e.slug},t.prototype.humanized_filter_name=function(t){var e,n,r,i;for(i=this.filters,n=0,r=i.length;r>n;n++)if(e=i[n],e.id===t)return e.name},t.prototype.is_filter=function(t){var e,n,r,i;for(i=this.filters,n=0,r=i.length;r>n;n++)if(e=i[n],e.id===t)return!0;return!1},t.prototype.is_tag=function(t){var e,n,r,i;for(i=this.tags,n=0,r=i.length;r>n;n++)if(e=i[n],e.id===t)return!0;return!1},t.prototype.get_tag_by_name=function(t){var e,n,r,i;for(i=this.tags,n=0,r=i.length;r>n;n++)if(e=i[n],e.name===t)return e;return!1},t.prototype.get_tag=function(t){var e,n,r,i;for(i=this.tags,n=0,r=i.length;r>n;n++)if(e=i[n],e.id===t)return e;return!1},t.prototype.get_filter=function(t){var e,n,r,i;for(i=this.filters,n=0,r=i.length;r>n;n++)if(e=i[n],e.id===t)return e;return!1},t.prototype.load_fish=function(t,e){var n,r;return r=this,n=this.fishpond,n.connection.request(["ponds",this.id,"fish?page="+t],function(i){var o,s,a,u;for(a=0,u=i.length;u>a;a++)s=i[a],o=new Fishpond.prototype.Fish(r),o.build(s),r.fish.push(o);return n.trigger("loading",r.fish.length/r.fish_count),n.debug("Loaded "+r.fish.length+"/"+r.fish_count),i.length>0?r.load_fish(t+1,e):e()})},t}(),Fishpond.prototype.Fish=function(){function t(t){this.pond=t}return t.prototype.build=function(t){return this.id=t.id,this.title=t.title,this.tags=t.tags,this.community_tags=t.community_tags,this.humanized_tags=[],this.humanized_filters=[],this.is_cached=!1,this.up_voted=!1,this.metadata={},this.humanize_tags()},t.prototype.humanize_tags=function(){var t,e,n,r;n=this.tags,r=[];for(t in n)e=n[t],this.pond.is_tag(t)&&this.humanized_tags.push({name:this.pond.humanized_tag_name(t),slug:this.pond.slugged_tag_name(t),token:t,value:e}),this.pond.is_filter(t)?r.push(this.humanized_filters.push({name:this.pond.humanized_filter_name(t),slug:this.pond.slugged_filter_name(t),token:t,value:e})):r.push(void 0);return r},t.prototype.matches_filters=function(t){var e,n,r,i,o,s,a,u;o=!0,n=[],s=[];for(r in t)a=t[r],Boolean(a)&&s.push(this.pond.get_filter(r).group);u=this.pond.filters;for(i in u)e=u[i],t[e.id]&&Boolean(this.tags[e.id])&&Boolean(t[e.id])&&n.push(e.group);return s=Fishpond.prototype.array_unique(s),n=Fishpond.prototype.array_unique(n),0===s.count?!1:Fishpond.prototype.arrays_equal(s,n)},t.prototype.is_filtered=function(t){var e,n,r,i;e=0,r=!0;for(n in t)i=t[n],Boolean(i)&&(e+=1,Boolean(this.tags[n])&&(r=!1));return e>0&&r},t.prototype.popularity=function(){return this.tags.popularity},t.prototype.calculate_score=function(t){var e,n,r,i;n=0,e=this.community_ratio(t);for(r in t)i=t[r],n+=this.calculate_tag_score(r,i,e);return Math.round(n)},t.prototype.calculate_tag_score=function(t,e,n){var r;return e===!1||void 0===this.tags[t]?0:(r=void 0===this.community_tags[t]?this.tags[t]-e:n*this.community_tags[t]+(1-n)*this.tags[t]-e,r*r)},t.prototype.community_ratio=function(t){var e;return e=t.community,void 0===e?0:e/20},t.prototype.add_community_tags=function(t,e){var n,r,i,o,s,a;n={},a=this,r=function(){return e()};for(i in t)s=t[i],o=a.pond.get_tag_by_name(i).id,n[o]=s;return this.pond.fishpond.connection.request(["ponds",this.pond.id,"fish",this.id,"feedbacks"],r,{community_feedback:n})},t.prototype.up_vote=function(){var t;return t=this,this.pond.fishpond.connection.request(["ponds",this.pond.id,"fish",this.id,"up_vote"],function(){return t.up_voted=!0})},t.prototype.load_metadata=function(){return console.warn("Warning `Fishpond::Fish.load_metadata` has been deprecated. Please use `get_metadata` instead.")},t.prototype.get_metadata=function(t){var e;return this.is_cached?t(this):(e=this,this.pond.fishpond.connection.request(["ponds",this.pond.id,"fish",this.id],function(n){return e.metadata=n,e.is_cached=!0,t(e)}))},t}(),Fishpond.prototype.Result=function(){function t(){this.score=void 0,this.fish=void 0}return t}()}.call(this),function(){String.prototype.score=function(t){var e,n,r,i,o,s,a,u,p,h,c,f,l,d,g,y;if(f=this,f===t)return 1;for(l=f.length,d=0,c=0,s=g=0,y=t.length;y>g;s=++g){if(r=t[s],a=f.indexOf(r.toLowerCase()),u=f.indexOf(r.toUpperCase()),h=Math.min(a,u),p=h>-1?h:Math.max(a,u),-1===p)return 0;i=.1,f[p]===r&&(i+=.1),0===p&&(i+=.8,0===s&&(c=1))," "===f.charAt(p-1)&&(i+=.8),f=f.substring(p+1,l),d+=i}return e=t.length,n=d/e,o=(n*(e/l)+n)/2,c&&1>o+.1&&(o+=.1),o}}.call(this),function(){Fishpond.prototype.query=function(t,e){var n,r,i,o,s,a,u,p,h,c,f,l,d,g,y,_,v,m;this.debug("Querying "+this.pond),this.track(this.pond.name,"query","tags:"+JSON.stringify(t)+", filters:"+JSON.stringify(e),this.time_alive()),l=this.pond.default_query_tags(),r=this.pond.default_query_filters();for(u in t)p=t[u],f=this.pond.tag_ids[u],void 0!==f&&(l[f]=p===!1?!1:parseInt(p));for(s in e)a=e[s],n=this.pond.filter_ids[s],void 0!==n&&(r[n]=parseInt(a));for(c=[],v=this.pond.fish,d=0,y=v.length;y>d;d++)i=v[d],i.matches_filters(r)&&(h=new Fishpond.prototype.Result,h.score=i.calculate_score(l),h.fish=i,c.push(h));if(c.sort(function(t,e){return t.score===e.score?0:t.score>e.score?1:t.score<e.score?-1:void 0}),this.event_tracking_enabled)for(o=1,m=c.slice(0,30),g=0,_=m.length;_>g;g++)h=m[g],this.track(h.fish.title,"ranked","",o),o+=1;return this.trigger("resultsUpdated",c.slice(0,30)),!0},Fishpond.prototype.search=function(t){var e,n,r,i,o,s;for(this.debug("Searching for titles like "+t+" in "+this.pond),this.track(this.pond.name,"search",t,this.time_alive()),r=[],s=this.pond.fish,i=0,o=s.length;o>i;i++)e=s[i],n=new Fishpond.prototype.Result,n.score=e.title.score(t),n.fish=e,r.push(n);return r.sort(function(t,e){return t.score===e.score?0:t.score<e.score?1:t.score>e.score?-1:void 0}),r.slice(0,5)}}.call(this),function(){Fishpond.prototype.get_fish=function(t,e){var n,r;return r=this,r.debug("Sending metadata request for fish "+t),n=this.pond.find_fish(t),n.get_metadata(function(t){return e(t)})}}.call(this),function(){Fishpond.prototype.loading=function(t){return this.callbacks||(this.callbacks={}),this.callbacks.loading=t},Fishpond.prototype.ready=function(t){return this.callbacks||(this.callbacks={}),this.callbacks.ready=t},Fishpond.prototype.error=function(t){return this.callbacks||(this.callbacks={}),this.callbacks.error=t},Fishpond.prototype.resultsUpdated=function(t){return this.callbacks||(this.callbacks={}),this.callbacks.resultsUpdated=t}}.call(this);var JSONP=function(){function t(t,e){var n=document.createElement("script"),r=!1;n.src=t,n.async=!0;var o=e||a.error;"function"==typeof o&&(n.onerror=function(e){o({url:t,event:e})}),n.onload=n.onreadystatechange=function(){r||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(r=!0,n.onload=n.onreadystatechange=null,n&&n.parentNode&&n.parentNode.removeChild(n))},i||(i=document.getElementsByTagName("head")[0]),i.appendChild(n)}function e(t){return encodeURIComponent(t)}function n(n,r,i,u){var p,h=-1===(n||"").indexOf("?")?"?":"&";u=u||a.callbackName||"callback";var c=u+"_json"+ ++o;r=r||{};for(p in r)r.hasOwnProperty(p)&&(h+=e(p)+"="+e(r[p])+"&");return s[c]=function(t){i(t);try{delete s[c]}catch(e){}s[c]=null},t(n+h+u+"="+c),c}function r(t){a=t}var i,o=0,s=this,a={};return{get:n,init:r}}();!function(){var t={}.hasOwnProperty;Fishpond.prototype.Connection=function(){function e(t){this.fishpond=t,this.fishpond.debug("Connection created"),this.api_endpoint="http://www.ifish.io/api",this.request_queue=[],this.current_requests=0,this.max_simultaneous_requests=2,this.fishpond.options.development&&(this.fishpond.debug("Development connection selected"),this.api_endpoint="http://"+window.location.host+"/api"),this.fishpond.options.api_endpoint&&(this.api_endpoint=t.options.api_endpoint),this.fishpond.debug("Using API endpoint "+this.api_endpoint)}return e.prototype.api_resource_url=function(t){return[this.api_endpoint,t].join("/")},e.prototype.request=function(t,e,n){return this.send_request(t.join("/"),e,n)},e.prototype.parameterize_data=function(e){var n,r;return n=[],(r=function(e,i){var o,s,a,u,p;p=[];for(a in e)t.call(e,a)&&(u=e[a],u instanceof Array?p.push(function(){var t,e,n;for(n=[],s=t=0,e=u.length;e>t;s=++t)o=u[s],n.push(r(o,null!=i?""+i+"["+a+"][]":""+a+"[]"));return n}()):u instanceof Object?(null!=i?i+="["+a+"]":i=a,p.push(r(u,i))):p.push(n.push(null!=i?""+i+"["+a+"]="+u:""+a+"="+u)));return p})(e,null),n.join("&")},e.prototype.process_request=function(t,e,n){var r,i,o,s,a;return this.fishpond.debug("Requesting "+t),o=this.api_resource_url(t),a=this.fishpond,s=this,r=n,r||(r={}),r.v="1",r.k=a.api_key,i=this.parameterize_data(r),this.connect(o,r,function(t){return a.debug("Success"),a.debug(t),s.current_requests-=1,e(t),s.check_queue_and_process_next()})},e.prototype.check_queue_and_process_next=function(){var t;return this.current_requests<this.max_simultaneous_requests&&this.request_queue.length>0?(this.current_requests+=1,t=this.request_queue.shift(),this.process_request(t.resource,t.callback,t.data)):void 0},e.prototype.send_request=function(t,e,n){return this.request_queue.push({resource:t,callback:e,data:n}),this.check_queue_and_process_next()},e.prototype.connect=JSONP.get,e}()}.call(this),function(){Fishpond.prototype.track=function(t,e,n,r){return this.event_tracking_enabled?(this.log("Tracking: "+t+" | "+e+" | "+n+" | "+r),_gaq.push(["_trackEvent",t,e,n,r])):void 0}}.call(this);var test_results=[],assert=function(t,e){e||(e="No message provided."),test_results.push({message:e,result:t})},f=new Fishpond;assert(f.array_unique([]==[])),assert(f.array_unique([1]==[1])),assert(f.array_unique([1,1]==[1])),assert(f.array_unique([1,2,2]==[1,2])),assert(f.array_unique([1,2,2,3]==[1,2,3])),assert(f.array_unique([1,2,3]==[1,2,3])),assert(1==f.arrays_equal([],[])),assert(1==f.arrays_equal([0],[0])),assert(1==f.arrays_equal([0,1],[0,1])),assert(1==f.arrays_equal([1,0],[0,1]),"[1,0] should be equal to [0,1]"),show_results();